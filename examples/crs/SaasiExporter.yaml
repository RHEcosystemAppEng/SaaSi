apiVersion: v1
kind: SaasiExporter
metadata:
  # Unique at cluster/NS scope
  name: example
  # TODO: shoud this  be constrained to be in the same NS as the Saasi operator?
  namespace: saasi-ns
  # Generated by the system
  uuid: UUID
spec:
  # Can export one cluster and one application for each request
  cluster:
    # User defined ID, must be unique at cluster scope
    clusterId: CLUSTERID
    server: API-SERVER-URL
    # A token valid at the moment of the export
    token: TOKEN
  application:
    # User defined ID, must be unique at cluster scope
    name: APP
    # Ordered list of namespaces to export
    namespaces:
      - name: NS1
        # No default values are generated for each of the following mandatory params
        mandatory-params:
          # Provide the name of one of the exported ConfigMaps
          - configMap: MAP-1
            params:
              # Paramaters are given as a list of key names
              - PARAM-1
              - "..."
              - PARAM-N
status:
  # History provides a report of the export status for each request
  history:
    cluster:
    - clusterId: CLUSTERID
      # One of SCHEDULED, RUNNING, COMPLETED, FAILED
      state: SCHEDULED
      timestamp: t0
    - clusterId: CLUSTERID
      state: RUNNING
      timestamp: t1
    - clusterId: CLUSTERID
      state: COMPLETED
      timestamp: t2
      # Output folder contains configuration files like kubeconfig
      location: exporter/clusters/CLUSTERID
    - clusterId: CLUSTERID-2
      state: SCHEDULED
      timestamp: t0
    - clusterId: CLUSTERID-2
      state: FAILED
      timestamp: t1
      errorMessage: "Authentication error"
      # Output folder contains error logs
      location: exporter/clusters/CLUSTERID-2
    application:
    - clusterId: APP
      # One of SCHEDULED, RUNNING, COMPLETED, FAILED
      state: SCHEDULED
      timestamp: t0
    - clusterId: APP
      state: RUNNING
      timestamp: t1
    - clusterId: APP
      state: COMPLETED
      timestamp: t2
      # Output folder contains manifest files and kustomize configuration
      location: exporter/applications/APP
    - clusterId: APP-2
      state: SCHEDULED
      timestamp: t0
    - clusterId: APP-2
      state: FAILED
      timestamp: t1
      errorMessage: "Namespace NS1 not found"
      # Output folder contains error logs
      location: exporter/applications/APP

