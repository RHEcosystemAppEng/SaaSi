kustomize init --namespace custom-guestbook --autodetect --recursive

Bug:
Deployment image can contain reference to the old path: image remapping needed
Remove/Update? annotation:
image.openshift.io/triggers
Remove re-built ImageStreamTag
Rename CRB to avoid overriding existing one? (e.g. deploy on sae server)

## To Shawn
* Slack #forum-mig-crane
* Integration options: 
  * As crane CLI: **YES**
    * Howto: error handling?
  * As crane Go: **NO**
    * Howto: OpenShiftPlugin is executed as binary format
    * Howto: simplify launch mode
* Why not export CR/SCC and CRB?
  * 

# OpenShift plugin
curl -Lk https://github.com/migtools/crane-plugin-openshift/releases/download/v0.0.4/amd64-darwin-openshiftplugin-v0.0.4 -o OpenShiftPlugin
chmod +x OpenShiftPlugin
cp OpenShiftPlugin /Users/dmartino/.local/share/crane/plugins

# Designing command options
## crane moved to krane
`krane` aims to generate kustomize configurations
## --kustomize flag
Add --kustomize flag to `crane apply`

```bash
crane apply --optional-flags="build-for-kustomize=true"
```

# openshift-service-ca.crt issue
Solved by regular OpenShift plugin

# Possible issues

## crane issues
### Export RBAC cluster-scoped resources
Add the `--rbac-cluster-scoped` option:
```bash
  -r, --rbac-cluster-scoped      Enables export of cluster-scoped RBAC resources connected to the exported ServiceAccount's
```

If configured, it includes all the `ClusterRole`, `SecurityContextConstraint` and `ClusterRoleBinding` that are connected to any `ServiceAccount` defined in the exported namespace(s).

This resources will be stored in a dedicated folder under the export directory, like `cluster`.

### Apply to generate kustomize installer
Add the `--kustomize` option to generate a kustomize configuration for each exported namespace:
```bash
  -k, --kustomize      Generate the kustomize installer for the exported namespaces
```
Also includes one configuration folder for the cluster-scoped resources, if enabled.

For each namespace it creates the base kustomize configuration and also a template to override it:
* `base` contains the default resources generated by `crane apply`, apart from mandatory ConfigMap values and all Secrets
* `template` also regenerate Secrets and ConfigMaps
  * By default it extracts the ConfigMap values customizable env files in the template configuration
*  .... Same for Secrets

**TODO**: 
* `crane apply` option?
* `crane apply` plugin? (no such feature ATM)
* new `crane kustomize` command?
* Just another `saasi-app-exporter` app that also integrates the REST server?
  * How to define mandatory params in a way acceptable by crane, otherwise?

## Run as a REST server
Add command to just run as a server:
```bash
server            -- Run as a REST server and accepts incoming commands
```

Available options:
```bash
Flags:
  -p, --port number      The exposed port number (default 8080)
```

Exposes one path for any available command, like:
```bash
/apply            -- Apply the transformations to the exported resources and save results in an output directory
/export           -- Export the namespace resources in an output directory
...
```

Each path is invoked using POST request and the payload is a generic map like:
```json
{
  "command": "export",
  "flags": [
    {
      "--export-dir": "/tmp",
      "--namespace": "ABC",
      "...": "..."
    }
  ]
}
```

**TODO**: 
* Same `crane` repo or just another project?
* SaaSi project instead?
* In any case it must run `crane` from API, not the CLI binary

## plugin-openshift-issues
### Export RBAC cluster-scoped resources
If `--rbac-cluster-scoped` option is selected, it includes also all the `SecurityContextConstraint` and `ClusterRoleBinding` that are connected to any `ServiceAccount` defined in the exported namespace(s).

## SA cleaner
**NO** covered by OpenShiftPlugin

## Default cert cleaner
**NO** covered by OpenShiftPlugin

## Default rolebinding cleaner
**NO** covered by OpenShiftPlugin